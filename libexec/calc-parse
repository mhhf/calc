#!/usr/bin/env node
/**
 * calc-parse - Parse formulas/sequents using v2 parser
 *
 * Usage:
 *   calc parse "A -o B"        # Parse formula
 *   calc parse "A, B |- C"     # Parse sequent
 *   calc parse --latex "A * B" # Output LaTeX
 *
 * For v1 parser, use: calc parse-v1
 */

const v2 = require('../lib/v2');

async function main() {
  let args = process.argv.slice(2);

  // Parse flags
  const showLatex = args.includes('--latex');
  const showJson = args.includes('--json');
  args = args.filter(a => !a.startsWith('--'));

  const defaultInput = "-- : A -o B |- -- : C";
  const input = args[0] || defaultInput;

  try {
    // Detect if it's a sequent (has |-) or just a formula
    const isSequent = input.includes('|-');

    let ast;
    if (isSequent) {
      ast = await v2.parseSequent(input);
    } else {
      ast = await v2.parseFormula(input);
    }

    // Show parsed structure
    console.log("Input:", input);
    console.log("Type:", isSequent ? "sequent" : "formula");
    console.log();

    // ASCII output
    const ascii = await v2.render(ast, 'ascii');
    console.log("ASCII:");
    console.log("  " + ascii);

    // LaTeX output
    if (showLatex || !showJson) {
      const latex = await v2.render(ast, 'latex');
      console.log("\nLaTeX:");
      console.log("  " + latex);
    }

    // JSON output
    if (showJson) {
      console.log("\nJSON:");
      console.log(JSON.stringify(ast, null, 2));
    }
  } catch (e) {
    console.error("Parse error:", e.message);
    process.exit(1);
  }
}

main();
